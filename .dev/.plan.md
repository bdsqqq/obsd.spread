# obsd.spread implementation plan

## goal
custom BasesView that displays text file previews as card "covers" when no image is set.

## approach
extend BasesView, render first N lines of file content in a styled preview area.

## architecture

```
src/
  main.ts          - plugin entry, registerBasesView()
  spread-view.ts   - SpreadView extends BasesView
  types.ts         - config types
  styles.css       - card preview styles
```

## implementation steps

### phase 1: minimal viable view

1. **create SpreadView class**
   - extend BasesView
   - implement onDataUpdated() → render()
   - iterate this.data.data for entries
   - access file content via this.app.vault.read(entry.file)

2. **card rendering**
   - create card div with preview area
   - truncate content (configurable: first N chars or first N lines)
   - add file name/link header
   - handle markdown vs plain text

3. **configuration options**
   - preview length (lines or chars)
   - show/hide file name
   - font size
   - fallback when no text content

### phase 2: polish

4. **styling**
   - match obsidian theme variables
   - responsive grid (like grid-card-view)
   - hover effects

5. **edge cases**
   - binary files (skip or show placeholder)
   - empty files
   - very long lines (truncate)
   - frontmatter handling (strip or include?)

### phase 3: integration

6. **test in obsidian**
   - create test vault with bases
   - verify view appears in "Configure View" menu
   - test with various file types

## key code patterns (from grid-card-view)

```typescript
// main.ts registration
this.registerBasesView('spread', {
  name: 'Spread View',
  icon: 'file-text',
  factory: (controller, containerEl) => new SpreadView(controller, containerEl),
  options: SpreadView.getViewOptions,
});

// spread-view.ts structure
export class SpreadView extends BasesView {
  onDataUpdated(): void {
    this.render();
  }

  private async render(): void {
    this.containerEl.empty();
    for (const entry of this.data.data) {
      const content = await this.app.vault.read(entry.file);
      const preview = this.truncate(content, this.previewLength);
      // create card with preview
    }
  }
}
```

## config options schema

| option | type | default | description |
|--------|------|---------|-------------|
| previewLines | slider | 5 | lines to show |
| previewChars | slider | 200 | chars to show (alt) |
| showFileName | toggle | true | show header |
| stripFrontmatter | toggle | true | hide yaml |
| monoFont | toggle | false | use monospace |

## open risks

- **async in onDataUpdated**: need to verify if async file reads work in this lifecycle hook
- **performance**: reading many files could be slow — may need caching
- **frontmatter**: regex to strip `---...---` block
- **binary detection**: check file extension or first bytes?

## verification

- [ ] view appears in bases "Configure View"
- [ ] cards show text preview
- [ ] clicking card opens file
- [ ] config options work
- [ ] no console errors
- [ ] handles edge cases gracefully
