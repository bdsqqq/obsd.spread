# obsidian bases card view research

## summary

obsidian's bases feature (introduced v1.9) provides a card view layout for displaying notes as a gallery grid. customizing card covers is LIMITED but there ARE documented plugin APIs and css workarounds.

## official plugin api

### registering custom views

from [docs.obsidian.md/plugins/guides/bases-view](https://docs.obsidian.md/plugins/guides/bases-view):

```typescript
this.registerBasesView(ExampleViewType, {
  name: 'Example',
  icon: 'lucide-graduation-cap',
  factory: (controller, containerEl) => {
    new MyBasesView(controller, containerEl)
  },
  options: () => ([
    { type: 'text', displayName: 'Property separator', key: 'separator', default: ' - ' }
  ]),
});
```

### BasesView class

```typescript
export class MyBasesView extends BasesView implements HoverParent {
  hoverPopover: HoverPopover | null;
  private containerEl: HTMLElement;
  
  constructor(controller: QueryController, parentEl: HTMLElement) {
    super(controller);
    this.containerEl = parentEl.createDiv('bases-example-view-container');
  }
  
  public onDataUpdated(): void {
    // called when data changes
    // access this.data.groupedData for entries
    // access this.config.getOrder() for property order
  }
}
```

### key apis

- `entry.getValue(propertyName)` - get property value for entry
- `value.isEmpty()` - check if value is empty
- `value.toString()` - render as text
- `Value.renderTo` - mentioned in docs for "photos, links, icons, etc." but not fully documented
- `parsePropertyId(propertyName)` - returns `{ type, name }` where type is formula/note/file

## dom structure (inferred from css guide)

based on [EzraMarks/obsidian-bases-css-guide](https://github.com/EzraMarks/obsidian-bases-css-guide):

### known class names

- cards use ABSOLUTE POSITIONING (major limitation)
- card height is FIXED and not easily modifiable via css
- `--bases-cards-line-height` css variable exists for vertical offsets
- properties can be targeted by their initial formula name

### structure (hunch, not confirmed from source)

```
.bases-cards-container (?)
  .bases-card (?)
    .bases-card-cover (?) - for cover images
    .bases-card-properties (?)
      [property divs with absolute positioning]
```

## card view configuration

from forum/reddit discussions:

1. **image property selection**: in Configure View > select image property
2. **image fit**: cover, contain, fill options
3. **aspect ratio**: configurable per view
4. **cover images work with**: 
   - `Image(PropertyName)` formula function
   - image URLs in properties
   - attachment links like `[[image.png]]`
   - does NOT work with `![[image.png]]` syntax (embed syntax)

## limitations

1. **absolute positioning**: cards use absolute positioning, so flex/grid css doesn't work
2. **fixed height**: card height increases with properties, cannot be easily reduced
3. **no property-based styling**: no built-in way to style cards based on property values
4. **no iframe support**: confirmed by Licat on discord that HTML/iframes not supported in bases
5. **no `![[image]]` syntax**: embed-style image links don't work for covers

## workarounds

### ezra marks' css technique

1. **packing properties**: combine all values into one `list()` formula so height is fixed
2. **spacers**: empty formula properties named `spacer_X` for controlled vertical space
3. **link selectors**: abuse `link("c: title folder-" + file.folder, displayText)` to create css-targetable hrefs
4. **nested lists**: build html structure via nested lists in formulas

example formula:
```
list(
  link("c: title", file.name),
  list(
    link("c: artist", artist),
    link("c: year", year)
  )
)
```

css targeting:
```css
[href^="c: title"] { font-weight: bold; }
[href^="c: artist"] { color: gray; }
```

### for custom card content injection

**potential approaches**:

1. **create custom BasesView**: register entirely new view type via plugin api
   - full control over rendering
   - replaces built-in card view entirely
   
2. **monkey-patch onDataUpdated**: risky but could intercept rendering
   - access internal card elements
   - modify after render
   
3. **mutation observer**: watch for card DOM creation, inject content
   - fragile, depends on internal class names
   
4. **css + formulas**: use link() formulas to inject pseudo-elements
   - no actual DOM injection, just styling

## existing plugins

### grid card view plugin
[github.com/mafflerbach/obsidian-grid-card-view](https://github.com/mafflerbach/obsidian-grid-card-view)

- extends BasesView
- adjustable card width/height via sliders
- property grid layout option
- shows how to implement custom view from scratch

### maps plugin (official)
adds map layout to bases - shows obsidian team's own pattern for extending bases

## recommendations

for "spread" spread functionality:

1. **hunch**: building a custom BasesView is the cleanest approach
   - register via `this.registerBasesView()`
   - full control over card rendering
   - can inject any content into cards

2. **alternative**: mutation observer pattern
   - watch for `.bases-card` (or whatever the real class is) creation
   - inject custom elements after obsidian renders cards
   - fragile but requires less api surface

3. **need to verify**: actual dom class names in obsidian
   - inspect element in devtools to confirm
   - classes like `bases-cards-container`, `bases-card-cover` are guesses

## sources

- https://docs.obsidian.md/plugins/guides/bases-view
- https://help.obsidian.md/bases/views
- https://github.com/EzraMarks/obsidian-bases-css-guide
- https://github.com/mafflerbach/obsidian-grid-card-view
- https://forum.obsidian.md/t/improve-compatibility-of-bases-cards-with-css-snippets/104590
- https://forum.obsidian.md/t/bases-gallery-view-card-view/101365
